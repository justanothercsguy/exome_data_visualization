<!DOCTYPE html>

<html lang="en-US">
    <head>
        <title>Exome Browser</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.13.0/d3.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        
        {% load static %}
        <script src="{% static 'visualization/js/chart.js' %}"></script>
        <script src="{% static 'visualization/js/gene.js' %}"></script>

        <!-- 
            This script below can be turned into a separate JS file later
        -->
        <script type="text/javascript">

            // get strings from views.py
            var exonStartsString = "{{gene.exonstarts}}";
            var exonEndsString = "{{gene.exonends}}";
            var cdsStartString = "{{gene.cdsstart}}";
            var cdsEndString = "{{gene.cdsend}}";
            var exonCount = "{{gene.exoncount}}";
            var variant_list = "{{variant_list_json}}";
            var gene = null;

            $(window).on("load", function() {
                // remove '&quot;' string and parse json from variant_list
                variant_list = JSON.parse(variant_list.replace(/&quot;/g,'"'));
                console.log("variant_list");
                console.log(variant_list);

                // exonStarts and exonEnds have a trailing comma that must be removed
                var exonStarts = exonStartsString.split(",");
                var exonEnds = exonEndsString.split(",");
                exonStarts.pop()
                exonEnds.pop()
                
                exonCount = parseInt(exonCount);
                console.log("exonCount");
                console.log(exonCount);

                for (var i = 0; i < exonCount; i++) {
                    exonStarts[i] = parseInt(exonStarts[i]);
                    exonEnds[i] = parseInt(exonEnds[i]);
                }
                
                var cdsStart = parseInt(cdsStartString);
                var cdsEnd = parseInt(cdsEndString);

                gene = new Gene(cdsStart, cdsEnd, exonStarts, exonEnds);
                console.log("gene");
                console.log(gene);
            });
        </script>
    </head>
    <body>
        <h3>Gene: {{ gene.exonstarts }}</h3>
        <div class="y-axis-button-container">
            <button type="button" class="MAF" value="MAF" onclick="changeYAxisVariable('MAF')">MAF</button>
            <button type="button" class="alleleNumber" value="alleleNumber" onclick="changeYAxisVariable('alleleNumber')">alleleNumber</button>
        </div>
        <div class="chart-zoomed-out"></div>
        <div class="chart-zoomed-in"></div>
        <ul>
            <li>cdsstart: {{ gene.cdsstart }}</li>
            <li>cdsend: {{ gene.cdsend }}</li>
            <li>exonstarts: {{ gene.exonstarts }}</li>
            <li>exonends: {{ gene.exonends }}</li>
        </ul>
    </body>
</html>